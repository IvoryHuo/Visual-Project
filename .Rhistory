mutate(`Total` = rowSums(.[3:26]),na.rm = TRUE)
origin_dec_wider <- origin_dec %>%
group_by(DAY_TYPE,TIME_PER_HOUR,SUBZONE_N) %>%
summarise(`TOTAL_TRIPS` = sum(`TOTAL_TRIPS`)) %>%
ungroup() %>%
pivot_wider(names_from = TIME_PER_HOUR,
values_from = TOTAL_TRIPS) %>%
mutate(`Total` = rowSums(.[3:26],na.rm = TRUE))
mutate(`0-6` = rowSums(.[3:4],na.rm = TRUE)+ rowSums(.[15],na.rm = TRUE) + rowSums(.[20:23],na.rm = TRUE)) %>%
mutate(`7-10` = rowSums(.[24:26],na.rm = TRUE) + rowSums(.[5],na.rm = TRUE)) %>%
mutate (`11-14` = rowSums(.[6:9],na.rm = TRUE) ) %>%
mutate(`15-17` = rowSums(.[10:12],na.rm = TRUE)) %>%
mutate(`18-20` = rowSums(.[13:14],na.rm = TRUE) + rowSums(.[16],na.rm = TRUE)) %>%
mutate (`21-23`= rowSums(.[17:19],na.rm = TRUE)) %>%
mutate(`Total` = rowSums(.[3:26],na.rm = TRUE)) %>%
select(`DAY_TYPE`,`SUBZONE_N`,`0-6`,`7-10`,`11-14`,`15-17`,`18-20`,`21-23`,`Total`)
####------try-plot-map——with categorized time dec data------
origin_dec_wider<- read_rds(file='SG_Bus_Commuting/data/rds/origin_dec_wider.rds')
View(origin_dec_wider)
View(origin_dec_wider)
write_rds(origin_dec_wider,'SG_Bus_Commuting/data/rds/origin_dec_wider.rds')
####------try-plot-map——with categorized time dec data------
origin_dec_wider<- read_rds(file='SG_Bus_Commuting/data/rds/origin_dec_wider.rds')
View(mpsz_origin_dec)
View(origin_dec_wider)
View(origin_dec_wider)
origin_dec_wider <- origin_dec %>%
group_by(DAY_TYPE,TIME_PER_HOUR,SUBZONE_N) %>%
summarise(`TOTAL_TRIPS` = sum(`TOTAL_TRIPS`)) %>%
ungroup() %>%
pivot_wider(names_from = TIME_PER_HOUR,
values_from = TOTAL_TRIPS) %>%
mutate(`Total` = rowSums(.[3:26],na.rm = TRUE))
write_rds(origin_dec_wider,'SG_Bus_Commuting/data/rds/origin_dec_wider.rds')
####------try-plot-map——with categorized time dec data------
origin_dec_wider<- read_rds(file='SG_Bus_Commuting/data/rds/origin_dec_wider.rds')
View(origin_dec_wider)
View(origin_dec_wider)
View(mpsz)
View(mpsz)
#plot
mpsz_origin_dec <-left_join(mpsz,origin_dec_wider, by = c('SUBZONE_N'='SUBZONE_N')) %>%
select(3,16,42:43)
#plot
mpsz_origin_dec <-left_join(mpsz,origin_dec_wider, by = c('SUBZONE_N'='SUBZONE_N')) %>%
select(3,16,41:42)
View(mpsz_origin_dec)
View(mpsz_origin_dec)
#plot
mpsz_origin_dec <-left_join(mpsz,origin_dec_wider, by = c('SUBZONE_N'='SUBZONE_N')) %>%
select(3,16,18:42)
#plot
mpsz_origin_dec <-left_join(mpsz,origin_dec_wider, by = c('SUBZONE_N'='SUBZONE_N')) %>%
select(3,16,17:42)
tm_shape(mpsz_origin_dec) +
tm_polygons()
tm_shape(mpsz_origin_dec) +
tm_fill("Total",
n = 20,
#breaks = c(0,3*10^5,4.5*10^5,6*10^5,10^6),
palatte = "Blues",
legend.hist = TRUE,
legend.is.portrait = TRUE,
legend.hist.z = 0.1) +
tm_borders(alpha = 0.5) +
tm_layout(main.title = "Distribution of SG Bus Commuting Trips by planning subzone \n subzone as Origin",
main.title.position = "center",
main.title.size = 1,
legend.height = 0.45,
legend.width = 0.35,
legend.outside=FALSE,
legend.position = c("right","bottom"),
frame = FALSE)
tm_shape(mpsz_origin_dec) +
tm_fill("Total",
n = 6,
#breaks = c(0,3*10^5,4.5*10^5,6*10^5,10^6),
palatte = "Blues",
legend.hist = TRUE,
legend.is.portrait = TRUE,
legend.hist.z = 0.1) +
tm_borders(alpha = 0.5) +
tm_layout(main.title = "Distribution of SG Bus Commuting Trips by planning subzone \n subzone as Origin",
main.title.position = "center",
main.title.size = 1,
legend.height = 0.45,
legend.width = 0.35,
legend.outside=FALSE,
legend.position = c("right","bottom"),
frame = FALSE)
tm_shape(mpsz_origin_dec) +
tm_fill("Total",
n = 12,
#breaks = c(0,3*10^5,4.5*10^5,6*10^5,10^6),
palatte = "Blues",
legend.hist = TRUE,
legend.is.portrait = TRUE,
legend.hist.z = 0.1) +
tm_borders(alpha = 0.5) +
tm_layout(main.title = "Distribution of SG Bus Commuting Trips by planning subzone \n subzone as Origin",
main.title.position = "center",
main.title.size = 1,
legend.height = 0.45,
legend.width = 0.35,
legend.outside=FALSE,
legend.position = c("right","bottom"),
frame = FALSE)
tm_shape(mpsz_origin_dec) +
tm_fill("Total",
#n = 12,
breaks = c(0,3*10^5,4.5*10^5,6*10^5,10^6),
palatte = "Blues",
legend.hist = TRUE,
legend.is.portrait = TRUE,
legend.hist.z = 0.1) +
tm_borders(alpha = 0.5) +
tm_layout(main.title = "Distribution of SG Bus Commuting Trips by planning subzone \n subzone as Origin",
main.title.position = "center",
main.title.size = 1,
legend.height = 0.45,
legend.width = 0.35,
legend.outside=FALSE,
legend.position = c("right","bottom"),
frame = FALSE)
summary(mpsz_origin_dec$Total)
tm_shape(mpsz_origin_dec) +
tm_fill("Total",
#n = 12,
breaks = c(0,2.5*10^5,6.5*10^5,1.2*10^6,1.5*10^6,2*10^7),
palatte = "Blues",
legend.hist = TRUE,
legend.is.portrait = TRUE,
legend.hist.z = 0.1) +
tm_borders(alpha = 0.5) +
tm_layout(main.title = "Distribution of SG Bus Commuting Trips by planning subzone \n subzone as Origin",
main.title.position = "center",
main.title.size = 1,
legend.height = 0.45,
legend.width = 0.35,
legend.outside=FALSE,
legend.position = c("right","bottom"),
frame = FALSE)
tm_shape(mpsz_origin_dec) +
tm_fill("Total",
#n = 12,
breaks = c(0,2.5*10^5,6.5*10^5,1.2*10^6,1.5*10^6,2*10^7),
style = "quantile",
palatte = "Blues",
legend.hist = TRUE,
legend.is.portrait = TRUE,
legend.hist.z = 0.1) +
tm_borders(alpha = 0.5) +
tm_layout(main.title = "Distribution of SG Bus Commuting Trips by planning subzone \n subzone as Origin",
main.title.position = "center",
main.title.size = 1,
legend.height = 0.45,
legend.width = 0.35,
legend.outside=FALSE,
legend.position = c("right","bottom"),
frame = FALSE)
runApp('C:/Users/huoda/AppData/Local/Temp/Temp1_04-prototype-Choropleth_mapping_interactive.zip/04-prototype-Choropleth_mapping_interactive')
mpsz <- st_read(dsn = "SG_Bus_Commuting_sample/data/geospatial",
layer = "MP14_SUBZONE_WEB_PL")
mpsz <- st_read(dsn = "SG_Bus_Commuting/sample/data/geospatial",
layer = "MP14_SUBZONE_WEB_PL")
popdata <- read_csv("SG_Bus_Commuting/sample/data/aspatial/respopagesextod2011to2020.csv")
pacman::p_load(shiny, sf, tmap, bslib, tidyverse)
shiny::runApp('SG_Bus_Commuting/sample')
shiny::runApp('SG_Bus_Commuting')
#Add geospatial dataset below
##huoda mpxx data
H_mpsz_origin_dec <-left_join(mpsz,H_origin_dec_wider, by = c('SUBZONE_N'='SUBZONE_N')) %>%
select(3,16,17:42)
#Load R Packages
## Add all your packages here
packages <- c('shiny', 'shinydashboard', 'shinythemes',
'sf','tmap',
'plotly', 'tidyverse', 'ggstatsplot',
'tools')
for (p in packages){
library(p, character.only=T)
}
# Read rds data file
## compared with csv, rds save space and have a faster speed to read in data
oct <- readRDS(file = "data/oct_data.rds") #2022-10 total trips
nov <- readRDS(file = "data/nov_data.rds") #2022-11 total trips
dec <- readRDS(file = "data/dec_data.rds") #2022-12 total trips
bus_info <- read_csv("data/BusStopURA2014SZ.csv") #bustop_code and pa, region info
total <- readRDS(file = "data/total_data.rds") #2022 oct-dec total trips
#huoda original rds file
H_origin_dec_wider <-read_rds(file = "data/rds/origin_dec_wider.rds")
#Load R Packages
## Add all your packages here
packages <- c('shiny', 'shinydashboard', 'shinythemes',
'sf','tmap',
'plotly', 'tidyverse', 'ggstatsplot',
'tools')
for (p in packages){
library(p, character.only=T)
}
# Read rds data file
## compared with csv, rds save space and have a faster speed to read in data
oct <- readRDS(file = "data/oct_data.rds") #2022-10 total trips
# Read rds data file
## compared with csv, rds save space and have a faster speed to read in data
oct <- readRDS(file = "data/rds/oct_data.rds") #2022-10 total trips
# Read rds data file
## compared with csv, rds save space and have a faster speed to read in data
oct <- readRDS(file = "data/oct_data.rds") #2022-10 total trips
#huoda original rds file
H_origin_dec_wider <-read_rds(file = "data/rds/origin_dec_wider.rds")
runApp('SG_Bus_Commuting')
# Read rds data file
## compared with csv, rds save space and have a faster speed to read in data
oct <- readRDS(file = "SG_Bus_Commuting/data/oct_data.rds") #2022-10 total trips
runApp('SG_Bus_Commuting')
#Load R Packages
## Add all your packages here
pacman::p_load('shiny', 'shinydashboard', 'shinythemes',
'sf','tmap',
'plotly', 'tidyverse', 'ggstatsplot',
'tools')
# Read rds data file
## compared with csv, rds save space and have a faster speed to read in data
oct <- readRDS(file = "data/oct_data.rds") #2022-10 total trips
#Load R Packages
## Add all your packages here
pacman::p_load('shiny', 'shinydashboard', 'shinythemes',
'sf','tmap',
'plotly', 'tidyverse', 'ggstatsplot',
'tools')
# Read rds data file
## compared with csv, rds save space and have a faster speed to read in data
oct <- readRDS(file = "data/rds/oct_data.rds") #2022-10 total trips
nov <- readRDS(file = "data/rds/nov_data.rds") #2022-11 total trips
dec <- readRDS(file = "data/rds/dec_data.rds") #2022-12 total trips
bus_info <- read_csv("data/BusStopURA2014SZ.csv") #bustop_code and pa, region info
total <- readRDS(file = "data/rds/total_data.rds") #2022 oct-dec total trips
#huoda original rds file
H_origin_dec_wider <-read_rds(file = "data/rds/origin_dec_wider.rds")
#read geospatial data
mpbus <- st_read(dsn = "data/geo/busstop",layer = "BusStop")
mpsz <- st_read(dsn = "data/geo/sz",layer = "MP14_SUBZONE_NO_SEA_PL")
mppa <- st_read(dsn = "data/geo/pa",layer = "MP14_PLNG_AREA_NO_SEA_PL")
mpre <- st_read(dsn = "data/geo/region",layer = "MP14_REGION_WEB_PL")
#Add geospatial dataset below
##huoda mpxx data
H_mpsz_origin_dec <-left_join(mpsz,H_origin_dec_wider, by = c('SUBZONE_N'='SUBZONE_N')) %>%
select(3,16,17:42)
#add a paragraph to introduce the proj
introduction = "Welcome to Singapore Bus Commuting Pattern Interactive Dashboard!"
#==============================================================================#
###### Shiny UI ######
#==============================================================================#
ui <- navbarPage(
title = "ShinyIDEA: Interactive SG Bus Commuting Pattern Exploration and Analysis",
fluid = TRUE,
theme=shinytheme("flatly"),
id = "navbarID",
tabPanel("Introduction",introduction),
tabPanel("EDA"),
navbarMenu("ESDA",
##### Shiny UI/Inferential Analysis/Correlation Analysis #####
tabPanel("Number of Commuters",
sidebarLayout(
sidebarPanel(width = 3,  #inputid should be unique, A/H/P_xx
selectInput(inputId = "H_hour",
label = "Select the hour:",
choices = c("0am" = "0","1am" = "1",
"2am" = "2","3am" = "3",
"4am" = "4","5am" = "5",
"6am" = "6","7am" = "7",
"8am" = "8","9am" = "9",
"10am" = "10","11am" = "11",
"12pm" = "12","1pm" = "13",
"2pm" = "14","3pm" = "15",
"4pm" = "16","5pm" = "17",
"6pm" = "18","7pm" = "19",
"8pm" = "20","9pm" = "21",
"10pm" = "22","11pm" = "23",
"total" = "Total"
),
selected = "20"),
selectInput(inputId = "H_classification",
label = "Classification method:",
choices = list("sd" = "sd",
"equal" = "equal",
"pretty" = "pretty",
"quantile" = "quantile",
"kmeans" = "kmeans",
"hclust" = "hclust",
"bclust" = "bclust",
"fisher" = "fisher",
"jenks" = "jenks"),
selected = "pretty"),
sliderInput(inputId = "H_classes",
label = "Number of classes:",
min = 6,max=12,
value = c(10)),
selectInput(inputId = "H_color",
label = "Choose your color scheme:",
choices = c("blue" = "Blues",
"red" = "Reds",
"green" = "Greens",
"Yellow-Orange-Red" = "YlOrRd"),
selected = "YlOrRd"),
textInput(inputId = "H_plotTitle1",
label = "Plot title",
placeholder = "Enter text to be used as plot title"),
actionButton(inputId = "H_goButton",
"Go!")
),
mainPanel(width = 9,
box(
##unique name A/H/P_xx
plotOutput("H_chorPlot",
height = "500px"))
)
)),
tabPanel("Commuter FLow")
),
navbarMenu("Cluster Analysis",
tabPanel("Hierarchical Clustering"),
tabPanel("Kmeans Clustering"),
tabPanel("Skater Clustering"),
tabPanel("ClustGeo Clustering")),
navbarMenu("Regression Analysis",
tabPanel("Gravity Model"),
tabPanel("Linear Mixed Model"),
tabPanel("Poisson Constrained Model"),
tabPanel("Poisson Unconstrained Model")),
tabPanel("Data Table")
)
#==============================================================================#
###### Shiny Server ######
#==============================================================================#
server <- function(input, output){
##### Shiny Server: Correlation Analysis #####
output$H_chorPlot <- renderTmap({
input$H_goButton
tmap_options(check.and.fix = TRUE) +
tm_shape(H_mpsz_origin_dec) +
tm_fill(input$H_hour,
n = input$H_classes,
style = input$H_classification,
palatte = input$H_color) +
tm_borders(lwd = 0.1, alpha = 1) +
tm_view(set.zoom.limits = c(11,14))
})
}
shinyApp(ui = ui, server = server)
runApp('sample/04-prototype-Choropleth_mapping_interactive')
runApp()
runApp()
pacman::p_load(shiny, sf, tmap, bslib, tidyverse)
mpsz <- st_read(dsn = "data/geospatial",
layer = "MP14_SUBZONE_WEB_PL")
mpsz <- st_read(dsn = "data/geospatial",
layer = "MP14_SUBZONE_WEB_PL")
mpsz <- st_read(dsn = "sample/data/geospatial",
layer = "MP14_SUBZONE_WEB_PL")
runApp('sample/04-prototype-Choropleth_mapping_interactive')
mpsz <- st_read(dsn = "data/geospatial",
layer = "MP14_SUBZONE_WEB_PL")
popdata <- read_csv("data/aspatial/respopagesextod2011to2020.csv")
pop <- popdata %>%
filter(Time == 2019) %>%
group_by(PA, SZ, AG) %>%
summarise(`POP` = sum(`Pop`)) %>%
ungroup()%>%
pivot_wider(names_from = AG,
values_from = POP) %>%
mutate(YOUNG = `0_to_4`+`5_to_9`+`10_to_14`+
`15_to_19`+`20_to_24`) %>%
mutate(`ECONOMY ACTIVE` = rowSums(.[9:13])+
rowSums(.[15:17]))%>%
mutate(`AGED`=rowSums(.[18:22])) %>%
mutate(`TOTAL`=rowSums(.[5:22])) %>%
mutate(`DEPENDENCY` = (`YOUNG` + `AGED`)
/`ECONOMY ACTIVE`) %>%
mutate_at(.vars = vars(PA, SZ),
.funs = funs(toupper)) %>%
select(`PA`, `SZ`, `YOUNG`,
`ECONOMY ACTIVE`, `AGED`,
`TOTAL`, `DEPENDENCY`) %>%
filter(`ECONOMY ACTIVE` > 0)
mpsz_demog <- left_join(mpsz,
pop,
by = c("SUBZONE_N" = "SZ"))
View(mpsz_demog)
View(mpsz_demog)
View(H_mpsz_origin_dec)
View(H_mpsz_origin_dec)
runApp()
runApp()
shiny::runApp()
shiny::runApp()
#huoda original rds file
H_origin_dec_wider <-read_rds(file = "data/rds/origin_dec_wider.rds")
mpsz <- st_read(dsn = "data/geo/sz",layer = "MP14_SUBZONE_NO_SEA_PL")
#Add geospatial dataset below
##huoda mpxx data
H_mpsz_origin_dec <-left_join(mpsz,H_origin_dec_wider, by = c('SUBZONE_N'='SUBZONE_N')) %>%
select(3,16,17:42)
View(H_mpsz_origin_dec)
View(H_mpsz_origin_dec)
pacman::p_load('shiny', 'shinydashboard', 'shinythemes',
'sf','tmap',
'plotly', 'tidyverse', 'ggstatsplot',
'tools')
H_origin_dec_wider <-read_rds(file = "data/rds/origin_dec_wider.rds")
mpsz <- st_read(dsn = "data/geo/sz",layer = "MP14_SUBZONE_NO_SEA_PL")
H_mpsz_origin_dec <-left_join(mpsz,H_origin_dec_wider, by = c('SUBZONE_N'='SUBZONE_N')) %>%
select(3,16,17:42)
tm_shape(H_mpsz_origin_dec) +
tm_fill("Total",
style = "quantile",
palette = "Blues",
title = "Dependency ratio") +
tm_borders(alpha = 0.5)
tm_shape(H_mpsz_origin_dec) +
tm_fill("Total",
style = "quantile",
palette = "Blues",
title = "Dependency ratio") +
tm_borders(alpha = 0.5) +
tm_layout(main.title = "Distribution of Dependency Ratio by planning subzone",
main.title.position = "center",
main.title.size = 1.2,
legend.height = 0.45,
legend.width = 0.35,
frame = TRUE)
tm_shape(H_mpsz_origin_dec) +
tm_fill("Total",
style = "quantile",
palette = "Blues",
title = "Dependency ratio") +
tm_borders(alpha = 0.5) +
tm_layout(main.title = "SG Bus Commuting Pattern",
main.title.position = "center",
main.title.size = 1.2,
legend.height = 0.45,
legend.width = 0.35,
frame = TRUE)
tm_shape(H_mpsz_origin_dec) +
tm_fill("Total",
style = "quantile",
palette = "Blues",
title = "Number of commuters") +
tm_borders(alpha = 0.5) +
tm_layout(main.title = "SG Bus Commuting Pattern",
main.title.position = "center",
main.title.size = 1.2,
legend.height = 0.45,
legend.width = 0.35,
frame = TRUE)
tm_shape(H_mpsz_origin_dec) +
tm_fill("0",
style = "quantile",
palette = "Blues",
title = "Number of commuters") +
tm_borders(alpha = 0.5) +
tm_layout(main.title = "SG Bus Commuting Pattern",
main.title.position = "center",
main.title.size = 1.2,
legend.height = 0.45,
legend.width = 0.35,
frame = TRUE)
tm_shape(H_mpsz_origin_dec) +
tm_fill("1",
style = "quantile",
palette = "Blues",
title = "Number of commuters") +
tm_borders(alpha = 0.5) +
tm_layout(main.title = "SG Bus Commuting Pattern",
main.title.position = "center",
main.title.size = 1.2,
legend.height = 0.45,
legend.width = 0.35,
frame = TRUE)
pacman::p_load('shiny', 'shinydashboard', 'shinythemes',
'sf','tmap',
'plotly', 'tidyverse', 'ggstatsplot',
'tools')
H_origin_dec_wider <-read_rds(file = "data/rds/origin_dec_wider.rds")
H_origin_dec_wider <-read_rds(file = "data/rds/origin_dec_wider.rds")
mpsz <- st_read(dsn = "data/geo/sz",layer = "MP14_SUBZONE_NO_SEA_PL")
H_mpsz_origin_dec <-left_join(mpsz,H_origin_dec_wider, by = c('SUBZONE_N'='SUBZONE_N')) %>%
select(3,16,17:42)
tm_shape(H_mpsz_origin_dec) +
tm_fill("1",
style = "quantile",
palette = "Blues",
title = "Number of commuters") +
tm_borders(alpha = 0.5) +
tm_layout(main.title = "SG Bus Commuting Pattern",
main.title.position = "center",
main.title.size = 1.2,
legend.height = 0.45,
legend.width = 0.35,
frame = TRUE)
runApp()
runApp()
sgpools <- read_csv("data/aspatial/SGPools_svy21.csv")
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
